# üéØ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: Runway API - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ratio

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

**–û—à–∏–±–∫–∞:**
```
"Model variant gen4-turbo is not available"
```

**–ó–∞—Ç–µ–º:**
```
`ratio` must be one of: 1280:720, 720:1280, 1104:832, 832:1104, 960:960, 1584:672
```

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç `ratio`

**–ë—ã–ª–æ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):**
```python
"ratio": "9:16"  # Aspect ratio - –ù–ï –†–ê–ë–û–¢–ê–ï–¢!
```

**–°—Ç–∞–ª–æ (–ü–†–ê–í–ò–õ–¨–ù–û):**
```python
"ratio": "720:1280"  # –¢–æ—á–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤ –ø–∏–∫—Å–µ–ª—è—Ö - –†–ê–ë–û–¢–ê–ï–¢!
```

### –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è `ratio`:

| –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `1280:720` | –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π HD (16:9) |
| **`720:1280`** | **–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π HD (9:16)** ‚Üê –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è —Å–µ–ª—Ñ–∏ |
| `1104:832` | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π |
| `832:1104` | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π |
| `960:960` | –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–π |
| `1584:672` | –®–∏—Ä–æ–∫–æ—Ñ–æ—Ä–º–∞—Ç–Ω—ã–π |

---

## üîß –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. `services_runway.py`

**–ë—ã–ª–æ:**
```python
payload = {
    "promptText": prompt,
    "model": model,
    "duration": duration,
    "ratio": "9:16" if "720x1280" in size else "16:9",  # –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!
    "watermark": False,
    "seed": None  # –¢–∞–∫–∂–µ –ø—Ä–æ–±–ª–µ–º–∞ - null –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
}
```

**–°—Ç–∞–ª–æ:**
```python
# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ratio
if "720x1280" in size or "720:1280" in size:
    ratio = "720:1280"  # Vertical HD
elif "1280x720" in size or "1280:720" in size:
    ratio = "1280:720"  # Horizontal HD
else:
    ratio = "720:1280"  # Default to vertical

# Runway image_to_video API –¢–†–ï–ë–£–ï–¢ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
if not image_bytes and not image_url:
    logger.error("‚ùå Runway image_to_video API requires an image!")
    return None

# Prepare image
if image_bytes:
    compressed_image = compress_image_for_api(image_bytes, max_size_kb=800)
    b64_image = base64.b64encode(compressed_image).decode("utf-8")
    prompt_image = f"data:image/jpeg;base64,{b64_image}"
elif image_url:
    prompt_image = image_url

# Build complete payload
payload = {
    "model": model,                # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
    "promptImage": prompt_image,   # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
    "promptText": prompt,          # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
    "duration": duration,          # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (default: 5)
    "ratio": ratio                 # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û, —Ç–æ—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–∏–∫—Å–µ–ª–µ–π!
}
```

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤

–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ:

```
üìä SUMMARY
Test 1: ratio='720:1280'                 ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
Test 2: duration=10                      ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
Test 3: ratio='1280:720'                 ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
Test 4: Minimal                          ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
Test 5: With seed                        ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
Test 6: With watermark                   ‚úÖ –†–ê–ë–û–¢–ê–ï–¢

‚úÖ –ù–∞–π–¥–µ–Ω —Ä–∞–±–æ—á–∏–π —Ñ–æ—Ä–º–∞—Ç!
```

**–ü—Ä–∏–º–µ—Ä—ã —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:**
- ‚úÖ Task ID: `d8b03508-a8a3-4590-ae09-788f16c4c6a3`
- ‚úÖ Task ID: `781d2c73-76c4-4970-8dfb-d14e2cdfc78d`
- ‚úÖ Task ID: `6c873017-ec73-449c-83a0-7a21724f2580`

---

## üìã –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Runway API

### –î–ª—è `/v1/image_to_video`:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `model` | string | ‚úÖ –î–∞ | `gen4_turbo` –∏–ª–∏ –¥—Ä—É–≥–∏–µ |
| `promptImage` | string | ‚úÖ –î–∞ | Base64 –∏–ª–∏ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è |
| `ratio` | string | ‚úÖ –î–∞ | –¢–æ—á–Ω—ã–π —Ä–∞–∑–º–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, `720:1280`) |
| `promptText` | string | ‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è | –û–ø–∏—Å–∞–Ω–∏–µ –∂–µ–ª–∞–µ–º–æ–≥–æ –≤–∏–¥–µ–æ |
| `duration` | number | ‚ùå –ù–µ—Ç | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5 (–¥–æ–ø—É—Å—Ç–∏–º—ã: 5, 10) |
| `seed` | number | ‚ùå –ù–µ—Ç | –î–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ (–Ω–µ `null`!) |
| `watermark` | boolean | ‚ùå –ù–µ—Ç | –î–æ–±–∞–≤–ª—è—Ç—å –ª–∏ –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫ |

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ API –∫–ª—é—á –Ω–∞—Å—Ç—Ä–æ–µ–Ω:

```bash
# –í —Ñ–∞–π–ª–µ back/keys.env
RUNWAY_API_KEY=–≤–∞—à_–∫–ª—é—á_–∑–¥–µ—Å—å
```

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:

```bash
cd back
python start.py
```

### 3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –≤–∏–¥–µ–æ:

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ "–°–µ–ª—Ñ–∏" –≤ –±–æ—Ç–∞
2. –î–æ–∂–¥–∏—Ç–µ—Å—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ–ª—Ñ–∏
3. –ù–∞–∂–º–∏—Ç–µ "üé¨ –í–∏–¥–µ–æ"
4. –í—ã–±–µ—Ä–∏—Ç–µ "–ò–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–µ–ª—Ñ–∏"

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏

**–£—Å–ø–µ—à–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è:**

```
üé¨ Starting Runway Gen-4 Turbo video generation...
   Model: gen4_turbo, Size: 720x1280, Duration: 5s
   Original prompt length: 856 chars
   Image input: from bytes (245.3KB, image-to-video mode)
[Runway] Request payload: {"model":"gen4_turbo","promptImage":"<base64_data>","promptText":"...","duration":5,"ratio":"720:1280"}
[Runway] Response keys: ['id']
[Runway] Got task ID: d8b03508-a8a3-4590-ae09-788f16c4c6a3, starting polling...
[Runway] Poll 1/120: status=processing
[Runway] Poll 5/120: status=succeeded
‚úÖ Video downloaded: 4567823 bytes
‚úÖ –í–∏–¥–µ–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: 4567823 –±–∞–π—Ç
```

**–í Telegram:**
```
üé¨ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –≤–∏–¥–µ–æ... (5 —Å–µ–∫—É–Ω–¥, –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-2 –º–∏–Ω—É—Ç—ã)
‚è≥ –í–∏–¥–µ–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è... (–æ—Å—Ç–∞–ª–æ—Å—å ~90 —Å–µ–∫)
‚è≥ –ü–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–æ... (–æ—Å—Ç–∞–ª–æ—Å—å ~30 —Å–µ–∫)
–í–æ—Ç –º–æ—ë –≤–∏–¥–µ–æ! üé•üíï
[–≤–∏–¥–µ–æ —Ñ–∞–π–ª]
```

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

1. ‚úÖ **Ratio —Ñ–æ—Ä–º–∞—Ç**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ—á–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –≤ –ø–∏–∫—Å–µ–ª—è—Ö (`720:1280`), –ù–ï aspect ratio (`9:16`)
2. ‚úÖ **Image –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω**: `/v1/image_to_video` –≤—Å–µ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
3. ‚úÖ **–ú–æ–¥–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç**: `gen4_turbo` –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞
4. ‚úÖ **–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**: `model`, `promptImage`, `ratio` - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
5. ‚úÖ **Duration**: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è 5 –∏ 10 —Å–µ–∫—É–Ω–¥

---

## üß™ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç:

```bash
cd back
python test_runway_final.py
```

–≠—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç –≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –ø–æ–∫–∞–∂–µ—Ç —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

## üéâ –í—Å—ë –≥–æ—Ç–æ–≤–æ!

–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞. API —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ. –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞ –∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ! üöÄ‚ú®

**–í–µ—Ä—Å–∏—è**: 3.0.3  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π  
**–î–∞—Ç–∞**: 2025-10-10

