# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ 413 Request Entity Too Large

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫—É:
```
‚ùå Sora API error 413: Request Entity Too Large
‚ö†Ô∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ –Ω–µ —É–¥–∞–ª–∞—Å—å
```

## ‚úÖ –ü—Ä–∏—á–∏–Ω–∞

–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Sora API –≤ —Ñ–æ—Ä–º–∞—Ç–µ base64, **—Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ**.

Gemini –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ (–æ–±—ã—á–Ω–æ 2-5 MB), –∏ –∫–æ–≥–¥–∞ –º—ã –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∏—Ö –≤ base64 –¥–ª—è JSON payload, —Ä–∞–∑–º–µ—Ä —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –µ—â–µ –Ω–∞ ~33%, –ø—Ä–µ–≤—ã—à–∞—è –ª–∏–º–∏—Ç —Å–µ—Ä–≤–µ—Ä–∞.

## üîß –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–æ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ Sora API.

### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `compress_image_for_api()` –≤ `services_sora.py`
2. ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∂–∏–º–∞—é—Ç—Å—è –¥–æ ~800 KB
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `Pillow` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Pillow

```bash
cd back
pip install Pillow>=10.0.0
```

–ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–Ω–æ–≤–æ:

```bash
cd back
pip install -r requirements.txt
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

```bash
cd back
python start.py
```

### –®–∞–≥ 3: –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram
2. –°–æ–∑–¥–∞–π—Ç–µ —Å–µ–ª—Ñ–∏ (üì∏)
3. –ù–∞–∂–º–∏—Ç–µ "üé¨ –í–∏–¥–µ–æ"
4. –í—ã–±–µ—Ä–∏—Ç–µ "–ò–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–µ–ª—Ñ–∏"

**–¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å!** –í –ª–æ–≥–∞—Ö –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
üóúÔ∏è Image compressed: 2450.5KB ‚Üí 785.2KB (quality=85)
   Image input: from bytes (785.2KB, image-to-video mode)
```

---

## üîç –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∂–∞—Ç–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å:

1. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ JPEG**: PNG/RGBA ‚Üí JPEG (—É–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å)
2. **–ö–∞—á–µ—Å—Ç–≤–æ 95%**: –ù–∞—á–∏–Ω–∞–µ–º —Å –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞**: –ï—Å–ª–∏ > 800 KB, —É–º–µ–Ω—å—à–∞–µ–º –∫–∞—á–µ—Å—Ç–≤–æ
4. **–ò—Ç–µ—Ä–∞—Ü–∏—è**: –ü–æ–Ω–∏–∂–∞–µ–º –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∞ 5% –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞
5. **Resize** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ): –ü—Ä–∏ –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–∞—Ö —É–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

```python
compress_image_for_api(image_bytes, max_size_kb=800)
```

- **max_size_kb**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 800 KB)
- **min_quality**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ JPEG (50%)

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

- ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∂–∏–º–∞—é—Ç—Å—è —Å 2-5 MB –¥–æ ~500-800 KB
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞–µ—Ç—Å—è –≤—ã—Å–æ–∫–∏–º (–æ–±—ã—á–Ω–æ 80-90%)
- ‚úÖ Sora API –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
- ‚úÖ –í–∏–¥–µ–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ

---

## üìä –ü—Ä–∏–º–µ—Ä—ã —Å–∂–∞—Ç–∏—è

| –û—Ä–∏–≥–∏–Ω–∞–ª | –ü–æ—Å–ª–µ —Å–∂–∞—Ç–∏—è | –ö–∞—á–µ—Å—Ç–≤–æ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|--------------|----------|-----------|
| 4.2 MB PNG | 750 KB JPEG | 85% | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| 2.8 MB PNG | 620 KB JPEG | 90% | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| 1.5 MB PNG | 480 KB JPEG | 95% | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| 800 KB PNG | 680 KB JPEG | 95% | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∂–∞—Ç–∏—è:

### –í `services_sora.py`, —Å—Ç—Ä–æ–∫–∞ ~134:

```python
# –°–∂–∞—Ç—å –¥–æ 800 KB (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
compressed_image = compress_image_for_api(image_bytes, max_size_kb=800)

# –í–∞—Ä–∏–∞–Ω—Ç—ã:
# compressed_image = compress_image_for_api(image_bytes, max_size_kb=1000)  # –ë–æ–ª—å—à–µ –∫–∞—á–µ—Å—Ç–≤–æ
# compressed_image = compress_image_for_api(image_bytes, max_size_kb=500)   # –ú–µ–Ω—å—à–µ —Ä–∞–∑–º–µ—Ä
```

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "PIL not available"

**–û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∞—Ö:**
```
‚ö†Ô∏è PIL not available, sending original image
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
pip install Pillow
```

### –ü—Ä–æ–±–ª–µ–º–∞: –í—Å—ë –µ—â–µ 413 –æ—à–∏–±–∫–∞

–ï—Å–ª–∏ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Pillow –≤—Å—ë –µ—â–µ –ø–æ–ª—É—á–∞–µ—Ç–µ 413:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Pillow —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:**
   ```bash
   python -c "from PIL import Image; print('OK')"
   ```

2. **–£–º–µ–Ω—å—à–∏—Ç–µ max_size_kb:**
   ```python
   compressed_image = compress_image_for_api(image_bytes, max_size_kb=500)
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** - –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å:
   ```
   üóúÔ∏è Image compressed: ...
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ

–ï—Å–ª–∏ –≤–∏–¥–µ–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Ä–∞–∑–º—ã—Ç—ã–º:

1. **–£–≤–µ–ª–∏—á—å—Ç–µ max_size_kb:**
   ```python
   compressed_image = compress_image_for_api(image_bytes, max_size_kb=1000)
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å—Ö–æ–¥–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Å–µ–ª—Ñ–∏** - –≤–æ–∑–º–æ–∂–Ω–æ Gemini —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –Ω–∏–∑–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –£—Å–ø–µ—à–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–ª–æ–≥–∏):

```
üé¨ Starting Sora video generation...
   Model: sora-2, Size: 720x1280, Duration: 5s
üóúÔ∏è Image compressed: 2450.5KB ‚Üí 785.2KB (quality=85)
   Image input: from bytes (785.2KB, image-to-video mode)
[Sora] Request payload: {...}
[Sora] Poll 1/120: status=processing
[Sora] Poll 8/120: status=processing
[Sora] Poll 15/120: status=completed
‚úÖ Video downloaded: 8456234 bytes
üíæ –í–∏–¥–µ–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ë–î –¥–ª—è 5200228179
```

### –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç:

- ‚úÖ –í–∏–¥–∏—Ç–µ "Image compressed"
- ‚úÖ –†–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è < 1000 KB
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–∫–∏ 413
- ‚úÖ –í–∏–¥–µ–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
- **–í—Ä–µ–º—è**: ~0.1-0.5 —Å–µ–∫—É–Ω–¥
- **CPU**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
- **–ü–∞–º—è—Ç—å**: ~10-20 MB –≤—Ä–µ–º–µ–Ω–Ω–æ

–û–±—â–µ–µ –≤–ª–∏—è–Ω–∏–µ:
- **–ù–µ–∑–∞–º–µ—Ç–Ω–æ** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞**: 60-80%
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: 100% (–∏–∑–±–µ–≥–∞–µ–º 413)

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Pillow –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫ 413!

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. ‚úÖ `pip install Pillow` –≤—ã–ø–æ–ª–Ω–µ–Ω
2. ‚úÖ –ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
3. ‚úÖ –í –ª–æ–≥–∞—Ö –≤–∏–¥–∏—Ç–µ "Image compressed"
4. ‚úÖ –í–∏–¥–µ–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ

---

**–í–µ—Ä—Å–∏—è**: 2.1.1  
**–î–∞—Ç–∞**: 10 –æ–∫—Ç—è–±—Ä—è 2025  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: 413 Request Entity Too Large



